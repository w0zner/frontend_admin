<app-sidebar> </app-sidebar>

<div class="main-content">
   <div class="header">
      <div class="header-body">
        <div class="row align-items-center">
          <div class="col">
            <div class="header-title">
              <h4 style="margin-bottom: 0px;">Productos</h4>
            </div>
          </div>
          <div class="col-auto">
            <div class="d-flex flex-wrap flex-md-nowrap justify-content-between">
                  <p class="font-size-sm font-weight-medium pl-md-4">
                    <a class="btn btn-primary lift" role="button" rel="noopener" [routerLink]="['/panel/productos/registro']"><i class="fe fe-plus"></i> Registrar nuevo</a>
                  </p>
              </div>
          </div>
        </div>
      </div>
    </div>

  <div class="card box-shadow border-0 card-hover">
    <div class="card-header border-0">
      <form [formGroup]="filtroForm" class="form-inline">
        <div class="btn-toolbar" role="toolbar" aria-label="Settings toolbar">
          <div class="btn-group mb-2" role="group" aria-label="Outline button group">
            <input class="form-control mr-sm-4" formControlName="titulo" type="text" id="inline-form-input-name"
              placeholder="Nombre producto">
            <button type="button" (click)="filtrar()" class="btn btn-primary"><i class="fe fe-search"></i>
              Buscar</button>
            <button type="button" (click)="limpiar()" class="btn btn-sm btn-secondary">
              <i class="fe fe-corner-down-left"></i></button>
          </div>
          <div class="btn-group me-2 mb-2" role="group" aria-label="Apply settings">
            <button type="button" class="btn btn-sm btn-outline-secondary" (click)="downloadExcel()">
              <i class="fe fe-download"></i>
              Descargar
            </button>
          </div>
        </div>
      </form>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="thead-dark">
            <tr>
              <th>#</th>
              <th>Titulo</th>
              <th>Stock</th>
              <th>Precio</th>
              <th>Categoria</th>
              <th>Ventas</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngIf="loading">
              <tr>
                <td class="text-center">
                  <div class="spinner-border text-muted" role="status" *ngIf="loading">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </td>
              </tr>
            </ng-container>
            <ng-container *ngIf="productos.length==0 && !loading">
              <tr>
                <td class="text-center">
                  <span class="text-muted">No hay registros disponibles</span>
                </td>
                <td></td>
              </tr>
            </ng-container>
            <ng-container>
              <tr
                *ngFor="let item of productos | slice: (page-1)*pageSize : (page-1)*pageSize+pageSize; let indice = index">
                <td>{{indice + 1}}</td>
                <td>
                  <h6 style="padding-bottom: 0; margin-bottom: 0;">
                    <img style="width: 50px;"
                      [src]="item.portada ? url + item.portada : 'assets/img/default-product.png'"
                      class="img-thumbnail " alt="Rounded image">
                    {{item.titulo}}
                  </h6>
                </td>
                <td>{{item.stock}}</td>
                <td>{{item.precio}}</td>
                <td>{{item.categoria}}</td>
                <td>{{item.ventas}}</td>
                <td style="text-align: center;">
                  <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fe fe-settings"></i>
                    Opciones</button>
                  <div class="dropdown-menu" style="color: #cccccc;">
                    <a class="dropdown-item" [routerLink]="['/panel/productos/registro/', item._id]"><i
                        class="fe fe-edit"></i> Editar</a>
                    <a class="dropdown-item" role="button" (click)="eliminar(item._id)" style="cursor: pointer; color: initial"><i
                        class="fe fe-trash"></i> Eliminar</a>
                    <a class="dropdown-item" [routerLink]="['/panel/productos/inventario/', item._id]"><i
                        class="fe fe-layers"></i> Inventario</a>
                    <a class="dropdown-item" [routerLink]="['/panel/productos/variedad/', item._id]"><i
                        class="fe fe-archive"></i> Variedades</a>
                    <a class="dropdown-item" [routerLink]="['/panel/productos/galeria/', item._id]"><i
                        class="fe fe-image"></i> Galería</a>
                    <a class="dropdown-item" [routerLink]="['/panel/productos/reviews/', item._id]"><i
                        class="fe fe-star"></i> Reseñas</a>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
    <div class="card-footer border-0">
      <ngb-pagination [(page)]="page" [pageSize]="pageSize" [collectionSize]="productos.length"></ngb-pagination>
    </div>
  </div>
</div>
